
Conversation with Gemini
<!DOCTYPE html>

<html lang="en">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Cerebrexia Final Pro - Finance Dashboard</title>

Â  Â Â 

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">

Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@600&display=swap" rel="stylesheet">

Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

Â  Â Â 

Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isBetween.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isSameOrAfter.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isSameOrBefore.js"></script>

Â  Â  <script>

Â  Â  Â  Â  dayjs.extend(window.dayjs_plugin_isBetween);

Â  Â  Â  Â  dayjs.extend(window.dayjs_plugin_isSameOrAfter);

Â  Â  Â  Â  dayjs.extend(window.dayjs_plugin_isSameOrBefore);

Â  Â  </script>



Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-functions-compat.js"></script>

Â  Â Â 

Â  Â  <style>

Â  Â  Â  Â  :root {

Â  Â  Â  Â  Â  Â  --primary-bg: #f4f7f6; --secondary-bg: #e8ecef; --card-bg: #ffffff;

Â  Â  Â  Â  Â  Â  --primary-accent: #005A9C; --text-primary: #121212; --text-secondary: #555;

Â  Â  Â  Â  Â  Â  --border-color: #ddd; --success-color: #28a745; --danger-color: #dc3545;

Â  Â  Â  Â  Â  Â  --warning-color: #ffc107; --info-color: #17a2b8; --shadow: 0 4px 6px rgba(0,0,0,0.05);

Â  Â  Â  Â  Â  Â  --font-body: 'Roboto', sans-serif; --font-header: 'Poppins', sans-serif;

Â  Â  Â  Â  }

Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }

Â  Â  Â  Â  body { font-family: var(--font-body); background-color: var(--primary-bg); color: var(--text-primary); }

Â  Â  Â  Â  .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; }

Â  Â  Â  Â  .overlay.show { opacity: 1; pointer-events: auto; }

Â  Â  Â  Â  .modal-content { background: var(--card-bg); padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: scale(0.95); transition: transform 0.3s; }

Â  Â  Â  Â  .overlay.show .modal-content { transform: scale(1); }

Â  Â  Â  Â  .loader-container { position: fixed; top: 20px; right: 20px; z-index: 2001; background-color: var(--primary-accent); color: white; padding: 10px 15px; border-radius: 8px; display: flex; align-items: center; gap: 10px; box-shadow: var(--shadow); opacity: 0; transition: opacity .3s; }

Â  Â  Â  Â  .loader-container.show { opacity: 1; }

Â  Â  Â  Â  .mini-loader { border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; width: 20px; height: 20px; animation: spin 1s ease-in-out infinite; }

Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

Â  Â  Â  Â  .container { max-width: 1600px; margin: 20px auto; padding: 20px; width: 100%; }

Â  Â  Â  Â  nav { display: flex; flex-wrap: wrap; justify-content: center; background-color: var(--card-bg); border-radius: 10px; margin-bottom: 30px; padding: 10px; box-shadow: var(--shadow); }

Â  Â  Â  Â  nav button { background: none; border: none; padding: 15px 25px; font-size: 1rem; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: 8px; transition: background-color .3s, color .3s; display: flex; align-items: center; gap: 8px; }

Â  Â  Â  Â  nav button:hover { background-color: var(--secondary-bg); }

Â  Â  Â  Â  nav button.active { background-color: var(--primary-accent); color: white; font-weight: 700; }

Â  Â  Â  Â  .page { display: none; }

Â  Â  Â  Â  .page.active { display: block; animation: fadeIn 0.5s; }

Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

Â  Â  Â  Â  h1, h2, h3 { font-family: var(--font-header); }

Â  Â  Â  Â  .section-title { font-size: 1.8rem; margin-bottom: 20px; color: var(--primary-accent); display: flex; align-items: center; gap: 12px; }

Â  Â  Â  Â  .section-subtitle { font-size: 1.5rem; margin-bottom: 15px; color: var(--text-primary); }

Â  Â  Â  Â  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }

Â  Â  Â  Â  .card { background-color: var(--card-bg); padding: 25px; border-radius: 10px; box-shadow: var(--shadow); border-left: 5px solid var(--primary-accent); }

Â  Â  Â  Â  .card h3 { font-size: 1rem; color: var(--text-secondary); margin-bottom: 10px; font-weight: 500; }

Â  Â  Â  Â  .card .amount { font-size: 2rem; font-weight: 700; color: var(--text-primary); }

Â  Â  Â  Â  .card .comparison { font-size: 0.9rem; color: var(--text-secondary); }

Â  Â  Â  Â  .card.income { border-left-color: var(--success-color); }

Â  Â  Â  Â  .card.expense { border-left-color: var(--danger-color); }

Â  Â  Â  Â  .card.expected { border-left-color: var(--warning-color); }

Â  Â  Â  Â  .card.info { border-left-color: var(--info-color); }

Â  Â  Â  Â  .section-box { background-color: var(--card-bg); padding: 25px; border-radius: 10px; box-shadow: var(--shadow); }

Â  Â  Â  Â  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }

Â  Â  Â  Â  .form { display: flex; flex-direction: column; gap: 15px; }

Â  Â  Â  Â  .form input, .form select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem; }

Â  Â  Â  Â  .form button { padding: 12px; border: none; border-radius: 5px; color: white; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color .3s; }

Â  Â  Â  Â  .table-container { overflow-x: auto; }

Â  Â  Â  Â  table { width: 100%; border-collapse: collapse; font-size: .95rem; }

Â  Â  Â  Â  th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); }

Â  Â  Â  Â  th { font-weight: 500; color: var(--text-secondary); background-color: #f9fafb; }

Â  Â  Â  Â  .action-btn { background: var(--primary-accent); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: .9rem; margin-right: 5px; display: inline-flex; align-items: center; justify-content: center; /* Center icon */ }

Â  Â  Â  Â  #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 2000; }

Â  Â  Â  Â  .toast { padding: 15px 20px; margin-bottom: 10px; border-radius: 5px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,.2); opacity: 0; transform: translateY(20px); transition: opacity .3s, transform .3s; }

Â  Â  Â  Â  .toast.show { opacity: 1; transform: translateY(0); }

Â  Â  Â  Â  .filter-controls { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; align-items: center; }

Â  Â  Â  Â  .filter-controls input, .filter-controls select, .filter-controls button { padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; }

Â  Â  Â  Â  .progress-bar { width: 100%; background-color: var(--secondary-bg); border-radius: 5px; overflow: hidden; height: 22px; }

Â  Â  Â  Â  .progress-bar-fill { height: 100%; background-color: var(--primary-accent); text-align: right; color: white; padding: 0 8px; line-height: 22px; font-size: .8rem; white-space: nowrap; transition: width .5s ease-out; }

Â  Â  Â  Â  .category-badge { background-color: var(--secondary-bg); color: var(--text-secondary); padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; font-weight: 500; }

Â  Â  Â  Â  .search-bar { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 20px; font-size: 1rem; }

Â  Â  </style>

</head>

<body>

Â  Â  <div id="loader-container" class="loader-container"><div class="mini-loader"></div><span>Loading Dashboard...</span></div>

Â  Â Â 

Â  Â  <div id="modal-container"></div>



Â  Â  <div id="app-container" class="container">

Â  Â  Â  Â  <nav>

Â  Â  Â  Â  Â  Â  <button class="nav-btn active" data-page="dashboard"><i class="fas fa-chart-line"></i>Dashboard</button>

Â  Â  Â  Â  Â  Â  <button class="nav-btn" data-page="summary"><i class="fas fa-chart-pie"></i>Summary</button>

Â  Â  Â  Â  Â  Â  <button class="nav-btn" data-page="expected_funds"><i class="fas fa-wallet"></i>Expected Funds</button>

Â  Â  Â  Â  Â  Â  <button class="nav-btn" data-page="budgets"><i class="fas fa-bullseye"></i>Budgets</button>

Â  Â  Â  Â  Â  Â  <button class="nav-btn" data-page="passbook"><i class="fas fa-book"></i>Passbook</button>

Â  Â  Â  Â  Â  Â  <button class="nav-btn" data-page="manage_data"><i class="fas fa-edit"></i>Manage Data</button>

Â  Â  Â  Â  Â  Â  <button id="sync-button" class="nav-btn" style="background-color: var(--info-color); color: white;" title="Sync data from automated sources via Cloud Function"><i class="fas fa-sync-alt"></i>Sync Automated</button>

Â  Â  Â  Â  </nav>



Â  Â  Â  Â  <main>

Â  Â  Â  Â  Â  Â  <div id="page-dashboard" class="page active">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Financial Overview</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card income"><h3>Total Income</h3><p class="amount" id="total-income">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card expense"><h3>Total Expenses</h3><p class="amount" id="total-expenses">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card"><h3>Net Balance</h3><p class="amount" id="net-remaining">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card info"><h3>Cash Flow (This Month)</h3><p class="amount" id="monthly-cashflow">â‚¹0</p><p class="comparison" id="monthly-cashflow-details">+â‚¹0 / -â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card warning"><h3>Avg. Daily Expense</h3><p class="amount" id="avg-daily-expense">â‚¹0</p><p class="comparison">(Last 30 days)</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card danger"><h3>Projected Runway</h3><p class="amount" id="runway-days">-- Days</p><p class="comparison">At current burn rate</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: 2fr 1fr;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box"><h3>Income Sources</h3><canvas id="income-doughnut-chart"></canvas></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box"><h3>Expense Categories</h3><canvas id="expense-pie-chart"></canvas></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box" style="grid-column: 1 / -1;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Balance Over Time</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="balance-line-chart"></canvas>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="page-summary" class="page">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Financial Summary</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-controls section-box" style="margin-bottom: 20px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Period:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <select id="summary-period-filter">

<option value="month">This Month</option>

<option value="year">This Year</option>

<option value="week">This Week</option>

<option value="last-month">Last Month</option>

<option value="custom">Custom Range</option>

</select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="summary-custom-range" style="display:none; gap: 15px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="summary-start-date">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="summary-end-date">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="summary-apply-filter" class="action-btn">Apply</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card income"><h3>Income</h3><p class="amount" id="summary-income">â‚¹0</p><p class="comparison" id="summary-income-comp">vs previous period</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card expense"><h3>Expenses</h3><p class="amount" id="summary-expense">â‚¹0</p><p class="comparison" id="summary-expense-comp">vs previous period</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card"><h3>Net</h3><p class="amount" id="summary-net">â‚¹0</p><p class="comparison" id="summary-net-comp">vs previous period</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Category Breakdown</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container"><table id="category-breakdown-table"></table></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="page-expected_funds" class="page">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Expected Funds</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card expected"><h3>Total Expected</h3><p class="amount" id="total-expected">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card income"><h3>Total Received</h3><p class="amount" id="total-received">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card"><h3>Remaining</h3><p class="amount" id="total-remaining-expected">â‚¹0</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: 1fr 2fr;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Add Expectation</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="expected-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="expected-source" placeholder="Source (e.g., Sponsor)" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="expected-amount" placeholder="Expected Amount" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="background-color: var(--warning-color); color: var(--text-primary);">Add Expectation</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Forecast List</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container" style="max-height: 300px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table id="expected-funds-table">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr><th>Source</th><th>Expected</th><th>Received</th><th>Remaining</th><th>Actions</th></tr></thead>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody></tbody>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="page-budgets" class="page">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Budget Management</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" style="grid-template-columns: 1fr 2fr; align-items: flex-start;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Add/Update Budget</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="add-budget-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="budget-category" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Select an Expense Category</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="budget-amount" placeholder="Budget Amount" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="background-color: var(--primary-accent);">Set Budget</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle" style="margin-top: 20px;">Defined Budgets</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container" style="max-height: 250px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table id="defined-budgets-table">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr><th>Category</th><th>Amount</th><th>Action</th></tr></thead>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody></tbody>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">This Month's Spending vs Budget</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="budgets-container" class="grid" style="grid-template-columns: 1fr 1fr;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="page-passbook" class="page">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Transaction Passbook</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-controls">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="start-date-filter">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="end-date-filter">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="category-filter"><option value="">All Categories</option></select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="type-filter"><option value="">All Types</option><option value="Income">Income</option><option value="Expense">Expense</option></select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="filter-btn" class="action-btn">Filter</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="clear-filter-btn" class="action-btn" style="background-color: var(--text-secondary);">Clear</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="export-csv-btn" class="action-btn" style="background-color: var(--success-color); margin-left: auto;">Export to CSV</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table id="passbook-table">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead><tr><th>Date</th><th>Description</th><th>Category</th><th>Type</th><th>Amount</th><th>Balance</th><th>Receipt</th></tr></thead>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody></tbody>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="page-manage_data" class="page">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">Add & Manage Manual Entries</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3><i class="fas fa-plus-circle" style="color:var(--success-color)"></i> Add Income</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="income-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="income-date" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="income-desc" placeholder="Description" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="income-category" required><option value="" disabled selected>Category</option><option>Sponsorship</option><option>Registration Fees</option><option>Batch Collection</option><option>Department Collection</option><option>Other</option></select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="income-amount" placeholder="Amount" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="background-color: var(--success-color);">Add Income</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3><i class="fas fa-minus-circle" style="color:var(--danger-color)"></i> Add Expense</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="expense-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="expense-date" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="expense-desc" placeholder="Description" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="expense-category" required>

<option value="" disabled selected>Category</option>

<option value="Artist & Talent">Artist & Talent</option>

<option value="Production">Production</option>

<option value="Marketing">Marketing</option>

<option value="Printing">Printing</option>

<option value="Prizes">Prizes</option>

<option value="Food & Catering">Food & Catering</option>

<option value="Logistics">Logistics</option>

<option value="Miscellaneous">Miscellaneous</option>

</select>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="expense-amount" placeholder="Amount" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="receipt-upload" accept="image/*,application/pdf">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="background-color: var(--danger-color);">Add Expense</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box" style="margin-top: 30px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Manage Income Entries</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-income" class="search-bar" placeholder="Search income entries...">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container"><table id="manage-income-table"><thead><tr><th>Date</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead><tbody></tbody></table></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-box" style="margin-top: 30px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">Manage Expense Entries</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-expense" class="search-bar" placeholder="Search expense entries...">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container"><table id="manage-expense-table"><thead><tr><th>Date</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead><tbody></tbody></table></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>

Â  Â  </div>



Â  Â  <script type="module">

Â  Â  Â  Â  // ===================================================================================

Â  Â  Â  Â  // === ðŸš¨ IMPORTANT SETUP INSTRUCTIONS ðŸš¨ ==========================================

Â  Â  Â  Â  // ===================================================================================

Â  Â  Â  Â Â 

Â  Â  Â  Â  // 1. ADD YOUR FIREBASE CONFIGURATION HERE

Â  Â  Â  Â  const firebaseConfig = {

Â  apiKey: "AIzaSyD1ZKsLTqnAfD_SSU3iQ36pU3aG71DZKGk",

Â  authDomain: "expensetrackerpro-f5964.firebaseapp.com",

Â  projectId: "expensetrackerpro-f5964",

Â  storageBucket: "expensetrackerpro-f5964.firebasestorage.app",

Â  messagingSenderId: "409195239506",

Â  appId: "1:409195239506:web:717208fd6d28687604a78b",

Â  measurementId: "G-0HTGG3S8EM"

};



Â  Â  Â  Â  // 2. SET YOUR FIRESTORE SECURITY RULES (IF YOU WANT NO LOGIN)

Â  Â  Â  Â  /*

Â  Â  Â  Â  Â  Â  rules_version = '2';

Â  Â  Â  Â  Â  Â  service cloud.firestore {

Â  Â  Â  Â  Â  Â  Â  match /databases/{database}/documents {

Â  Â  Â  Â  Â  Â  Â  Â  // WARNING: This allows ANYONE to read and write to your database.

Â  Â  Â  Â  Â  Â  Â  Â  // This is NOT secure. Use only if you understand the risks.

Â  Â  Â  Â  Â  Â  Â  Â  match /{document=**} {

Â  Â  Â  Â  Â  Â  Â  Â  Â  allow read, write: if true;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  */



Â  Â  Â  Â  // 3. CREATE FIRESTORE INDEXES

Â  Â  Â  Â  // Index 1: Collection 'transactions', Field 'date', Order 'Descending'

Â  Â  Â  Â  // Index 2: Collection 'expectedPayments', Field 'createdAt', Order 'Descending'

Â  Â  Â  Â Â 

Â  Â  Â  Â  // 4. (NEW) GOOGLE SHEET CONFIGURATION

Â  Â  Â  Â  const GOOGLE_API_KEY = 'AIzaSyBsf5q3I_HUMnuNC_Xel_cc6C29UYcO-Xs'; // Your Google Cloud API Key

Â  Â  Â  Â  const SHEET_ID = '1tru8u40xpTHIkr7zYSFK79TSOz4fHHiTkG_6r-zi6CQ'; // The ID of your Google Sheet

Â  Â  Â  Â  const SHEET_RANGE = "'22 BATCH'!E122"; // The specific cell you want to get (e.g., "'22 BATCH'!E122")



Â  Â  Â  Â  // ===================================================================================

Â  Â  Â  Â  // === APPLICATION CODE ==============================================================

Â  Â  Â  Â  // ===================================================================================



Â  Â  Â  Â  // --- FIREBASE INITIALIZATION ---

Â  Â  Â  Â  firebase.initializeApp(firebaseConfig);

Â  Â  Â  Â  const db = firebase.firestore();

Â  Â  Â  Â  const storage = firebase.storage();

Â  Â  Â  Â  const functions = firebase.functions();



Â  Â  Â  Â  // --- GLOBAL STATE & UI ELEMENTS ---

Â  Â  Â  Â  const state = {

Â  Â  Â  Â  Â  Â  transactions: [],

Â  Â  Â  Â  Â  Â  batchTransactions: [], // For Google Sheet data

Â  Â  Â  Â  Â  Â  expected: [],

Â  Â  Â  Â  Â  Â  budgets: {},

Â  Â  Â  Â  Â  Â  isLoading: false,

Â  Â  Â  Â  };

Â  Â  Â  Â  let chartInstances = {};

Â  Â  Â  Â  const loader = document.getElementById('loader-container');

Â  Â  Â  Â  const appContainer = document.getElementById('app-container');



Â  Â  Â  Â  // --- HELPER FUNCTIONS ---

Â  Â  Â  Â  const formatCurrency = (amount) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 2 }).format(amount || 0);

Â  Â  Â  Â  const todayISO = () => new Date().toISOString().split('T')[0];

Â  Â  Â  Â  const formatDateForInput = (timestamp) => {

Â  Â  Â  Â  Â  Â  if (!timestamp) return '';

Â  Â  Â  Â  Â  Â  const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);

Â  Â  Â  Â  Â  Â  return date.toISOString().split('T')[0];

Â  Â  Â  Â  };

Â  Â  Â  Â  const showToast = (message, type = 'success') => {

Â  Â  Â  Â  Â  Â  const container = document.getElementById('toast-container') || document.body.appendChild(Object.assign(document.createElement('div'), { id: 'toast-container' }));

Â  Â  Â  Â  Â  Â  const toast = Object.assign(document.createElement('div'), {

Â  Â  Â  Â  Â  Â  Â  Â  className: `toast`,

Â  Â  Â  Â  Â  Â  Â  Â  style: `background-color: ${type === 'error' ? 'var(--danger-color)' : 'var(--success-color)'}`,

Â  Â  Â  Â  Â  Â  Â  Â  textContent: message

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  container.appendChild(toast);

Â  Â  Â  Â  Â  Â  setTimeout(() => toast.classList.add('show'), 10);

Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.remove('show');

Â  Â  Â  Â  Â  Â  Â  Â  toast.addEventListener('transitionend', () => toast.remove());

Â  Â  Â  Â  Â  Â  }, 3000);

Â  Â  Â  Â  };

Â  Â  Â  Â  const setLoading = (isLoading, text = 'Working...') => {

Â  Â  Â  Â  Â  Â  state.isLoading = isLoading;

Â  Â  Â  Â  Â  Â  loader.querySelector('span').textContent = text;

Â  Â  Â  Â  Â  Â  loader.classList.toggle('show', isLoading);

Â  Â  Â  Â  };

Â  Â  Â  Â Â 

Â  Â  Â  Â  // Custom confirmation modal

Â  Â  Â  Â  let resolveConfirmPromise;

Â  Â  Â  Â  function showConfirmModal(message, onConfirm) {

Â  Â  Â  Â  Â  Â  const modalHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="overlay show">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-content">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="section-subtitle">${message}</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-cancel-btn" class="action-btn" style="background-color: var(--text-secondary);">Cancel</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-ok-btn" class="action-btn" style="background-color: var(--danger-color);">Confirm</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  modalContainer.innerHTML = modalHTML;



Â  Â  Â  Â  Â  Â  return new Promise((resolve) => {

Â  Â  Â  Â  Â  Â  Â  Â  resolveConfirmPromise = resolve; // Store resolve function to be called later

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confirm-ok-btn').onclick = () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(true); // Resolve with true if confirmed

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confirm-cancel-btn').onclick = () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(false); // Resolve with false if cancelled

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- DATA FETCHING & REAL-TIME LISTENERS ---

Â  Â  Â  Â  async function fetchSheetData() {

Â  Â  Â  Â  Â  Â  if (!GOOGLE_API_KEY || !SHEET_ID || !SHEET_RANGE) return;

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_RANGE)}?key=${GOOGLE_API_KEY}`;

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Failed to fetch sheet data. Check API key and Sheet ID.');

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (!data.values || !data.values[0] || !data.values[0][0]) return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const totalAmount = parseFloat(data.values[0][0].replace(/[^0-9.-]+/g,""));

Â  Â  Â  Â  Â  Â  Â  Â  if (isNaN(totalAmount)) return;



Â  Â  Â  Â  Â  Â  Â  Â  state.batchTransactions = [{

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: 'sheet-total-batch',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: todayISO(), // Sets the date to today

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: 'MBBS 22 BATCH',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: totalAmount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Income',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: 'Batch Collection',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isSheet: true, // Custom flag to identify this transaction

Â  Â  Â  Â  Â  Â  Â  Â  }];

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching Google Sheet data:", error);

Â  Â  Â  Â  Â  Â  Â  Â  showToast(error.message, "error");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function setupRealtimeListeners() {

Â  Â  Â  Â  Â  Â  setLoading(true, 'Fetching data...');



Â  Â  Â  Â  Â  Â  db.collection("transactions").orderBy("date", "desc").onSnapshot(snapshot => {

Â  Â  Â  Â  Â  Â  Â  Â  state.transactions = snapshot.docs.map(doc => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: doc.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...doc.data(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: doc.data().date ? formatDateForInput(doc.data().date) : todayISO(),

Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  renderAll(); // Re-render with new data from Firestore

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  }, error => {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching transactions: ", error);

Â  Â  Â  Â  Â  Â  Â  Â  showToast("Error: Could not fetch transactions. Check Firestore rules and indexes.", "error");

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  db.collection("expectedPayments").orderBy("createdAt", "desc").onSnapshot(snapshot => {

Â  Â  Â  Â  Â  Â  Â  Â  state.expected = snapshot.docs.map(doc => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = doc.data();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: doc.id, source: data.source,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  expectedAmount: data.expectedAmount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receivedAmount: data.receivedAmount || 0,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  renderAll();

Â  Â  Â  Â  Â  Â  }, error => console.error("Error fetching expected payments: ", error));



Â  Â  Â  Â  Â  Â  db.collection("budgets").onSnapshot(snapshot => {

Â  Â  Â  Â  Â  Â  Â  Â  state.budgets = snapshot.docs.reduce((acc, doc) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[doc.id] = doc.data().budgetAmount;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  Â  Â  renderAll();

Â  Â  Â  Â  Â  Â  }, error => console.error("Error fetching budgets: ", error));

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- RENDER FUNCTIONS ---

Â  Â  Â  Â  function renderAll() {

Â  Â  Â  Â  Â  Â  const allTransactions = [...state.transactions, ...state.batchTransactions];

Â  Â  Â  Â  Â  Â  const activePageId = document.querySelector('.page.active')?.id;

Â  Â  Â  Â  Â  Â  if (!activePageId) return;



Â  Â  Â  Â  Â  Â  switch(activePageId) {

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-dashboard': renderDashboard(allTransactions); break;

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-summary': updateSummaryPage(allTransactions); break;

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-expected_funds': renderExpectedFunds(state.expected); break;

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-budgets':Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  populateBudgetCategoryDropdown();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderBudgets(allTransactions, state.budgets);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-passbook':Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  populateFilterDropdowns(allTransactions);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderPassbook(allTransactions);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  case 'page-manage_data':Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // IMPORTANT: Manage data page ONLY shows Firestore data that can be edited/deleted

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderManageDataTables(state.transactions);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderDashboard(data) {

Â  Â  Â  Â  Â  Â  const income = data.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0);

Â  Â  Â  Â  Â  Â  const expenses = data.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0);

Â  Â  Â  Â  Â  Â  document.getElementById('total-income').textContent = formatCurrency(income);

Â  Â  Â  Â  Â  Â  document.getElementById('total-expenses').textContent = formatCurrency(expenses);

Â  Â  Â  Â  Â  Â  document.getElementById('net-remaining').textContent = formatCurrency(income - expenses);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const thisMonthTxns = data.filter(t => dayjs(t.date).isSame(dayjs(), 'month'));

Â  Â  Â  Â  Â  Â  const monthlyIncome = thisMonthTxns.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0);

Â  Â  Â  Â  Â  Â  const monthlyExpense = thisMonthTxns.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0);

Â  Â  Â  Â  Â  Â  document.getElementById('monthly-cashflow').textContent = formatCurrency(monthlyIncome - monthlyExpense);

Â  Â  Â  Â  Â  Â  document.getElementById('monthly-cashflow-details').textContent = `+${formatCurrency(monthlyIncome)} / ${formatCurrency(monthlyExpense)}`;



Â  Â  Â  Â  Â  Â  const last30DaysExpenses = data

Â  Â  Â  Â  Â  Â  Â  Â  .filter(t => t.type === 'Expense' && dayjs(t.date).isAfter(dayjs().subtract(30, 'day')))

Â  Â  Â  Â  Â  Â  Â  Â  .reduce((s, t) => s + t.amount, 0);

Â  Â  Â  Â  Â  Â  const avgDailyExpense = last30DaysExpenses > 0 ? last30DaysExpenses / 30 : 0;

Â  Â  Â  Â  Â  Â  document.getElementById('avg-daily-expense').textContent = formatCurrency(avgDailyExpense);



Â  Â  Â  Â  Â  Â  const runwayDays = avgDailyExpense > 0 ? Math.floor((income - expenses) / avgDailyExpense) : Infinity;

Â  Â  Â  Â  Â  Â  document.getElementById('runway-days').textContent = isFinite(runwayDays) ? `${runwayDays} Days` : 'âˆž Days';



Â  Â  Â  Â  Â  Â  updateDashboardCharts(data);

Â  Â  Â  Â  Â  Â  renderBalanceChart(data);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  function updateDashboardCharts(data) {

Â  Â  Â  Â  Â  Â  if (chartInstances['incomeDoughnut']) chartInstances['incomeDoughnut'].destroy();

Â  Â  Â  Â  Â  Â  if (chartInstances['expensePie']) chartInstances['expensePie'].destroy();

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const incomeCategories = data.filter(t => t.type === 'Income').reduce((acc, t) => {

Â  Â  Â  Â  Â  Â  Â  Â  acc[t.category] = (acc[t.category] || 0) + t.amount;

Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  }, {});



Â  Â  Â  Â  Â  Â  const expenseCategories = data.filter(t => t.type === 'Expense').reduce((acc, t) => {

Â  Â  Â  Â  Â  Â  Â  Â  acc[t.category] = (acc[t.category] || 0) + t.amount;

Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  }, {});



Â  Â  Â  Â  Â  Â  const getChartColors = (count) => {

Â  Â  Â  Â  Â  Â  Â  Â  const colors = ['#005A9C', '#4CAF50', '#FFC107', '#E91E63', '#9C27B0', '#2196F3', '#FF9800', '#795548', '#607D8B', '#00BCD4'];

Â  Â  Â  Â  Â  Â  Â  Â  return Array.from({ length: count }, (_, i) => colors[i % colors.length]);

Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  if(Object.keys(incomeCategories).length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â const incomeCtx = document.getElementById('income-doughnut-chart').getContext('2d');

Â  Â  Â  Â  Â  Â  Â  Â  chartInstances['incomeDoughnut'] = new Chart(incomeCtx, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'doughnut',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: Object.keys(incomeCategories),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ data: Object.values(incomeCategories), backgroundColor: getChartColors(Object.keys(incomeCategories).length) }]

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' }, title: { display: false } } }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if(Object.keys(expenseCategories).length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â const expenseCtx = document.getElementById('expense-pie-chart').getContext('2d');

Â  Â  Â  Â  Â  Â  Â  Â  chartInstances['expensePie'] = new Chart(expenseCtx, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'pie',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: Object.keys(expenseCategories),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ data: Object.values(expenseCategories), backgroundColor: getChartColors(Object.keys(expenseCategories).length) }]

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' }, title: { display: false } } }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderBalanceChart(transactions) {

Â  Â  Â  Â  Â  Â  if (chartInstances['balanceLine']) chartInstances['balanceLine'].destroy();



Â  Â  Â  Â  Â  Â  const sortedTxns = [...transactions].sort((a, b) => dayjs(a.date).diff(dayjs(b.date)));

Â  Â  Â  Â  Â  Â  let currentBalance = 0;

Â  Â  Â  Â  Â  Â  const chartData = [];



Â  Â  Â  Â  Â  Â  sortedTxns.forEach(txn => {

Â  Â  Â  Â  Â  Â  Â  Â  currentBalance += (txn.type === 'Income' ? txn.amount : -txn.amount);

Â  Â  Â  Â  Â  Â  Â  Â  chartData.push({ x: txn.date, y: currentBalance });

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const dailyBalances = chartData.reduce((acc, dataPoint) => {

Â  Â  Â  Â  Â  Â  Â  Â  acc[dataPoint.x] = dataPoint.y; // Keep the last balance for each day

Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  }, {});



Â  Â  Â  Â  Â  Â  const labels = Object.keys(dailyBalances).sort((a,b) => dayjs(a).diff(dayjs(b)));

Â  Â  Â  Â  Â  Â  const dataPoints = labels.map(label => dailyBalances[label]);



Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('balance-line-chart').getContext('2d');

Â  Â  Â  Â  Â  Â  chartInstances['balanceLine'] = new Chart(ctx, {

Â  Â  Â  Â  Â  Â  Â  Â  type: 'line',

Â  Â  Â  Â  Â  Â  Â  Â  data: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: labels,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: 'Net Balance',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: dataPoints,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'var(--primary-accent)',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(0, 90, 156, 0.1)',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fill: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tension: 0.1

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  options: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: { y: { ticks: { callback: (value) => formatCurrency(value) } } },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: { legend: { display: false } }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  function updateSummaryPage(transactions) {

Â  Â  Â  Â  Â  Â  const periodFilter = document.getElementById('summary-period-filter').value;

Â  Â  Â  Â  Â  Â  let start, end, pStart, pEnd;

Â  Â  Â  Â  Â  Â  const now = dayjs();

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  if (periodFilter === 'year') {

Â  Â  Â  Â  Â  Â  Â  Â  start = now.startOf('year');

Â  Â  Â  Â  Â  Â  Â  Â  end = now.endOf('year');

Â  Â  Â  Â  Â  Â  Â  Â  pStart = start.subtract(1, 'year');

Â  Â  Â  Â  Â  Â  Â  Â  pEnd = end.subtract(1, 'year');

Â  Â  Â  Â  Â  Â  } else if (periodFilter === 'week') {

Â  Â  Â  Â  Â  Â  Â  Â  start = now.startOf('week'); end = now.endOf('week');

Â  Â  Â  Â  Â  Â  Â  Â  pStart = start.subtract(1, 'week'); pEnd = end.subtract(1, 'week');

Â  Â  Â  Â  Â  Â  } else if (periodFilter === 'last-month') {

Â  Â  Â  Â  Â  Â  Â  Â  start = now.subtract(1, 'month').startOf('month'); end = now.subtract(1, 'month').endOf('month');

Â  Â  Â  Â  Â  Â  Â  Â  pStart = start.subtract(1, 'month'); pEnd = end.subtract(1, 'month');

Â  Â  Â  Â  Â  Â  } else if (periodFilter === 'custom') {

Â  Â  Â  Â  Â  Â  Â  Â  start = dayjs(document.getElementById('summary-start-date').value);Â 

Â  Â  Â  Â  Â  Â  Â  Â  end = dayjs(document.getElementById('summary-end-date').value);

Â  Â  Â  Â  Â  Â  Â  Â  const diff = end.diff(start, 'day');

Â  Â  Â  Â  Â  Â  Â  Â  pStart = start.subtract(diff + 1, 'day'); pEnd = end.subtract(diff + 1, 'day');

Â  Â  Â  Â  Â  Â  } else { // Default to month

Â  Â  Â  Â  Â  Â  Â  Â  start = now.startOf('month'); end = now.endOf('month');

Â  Â  Â  Â  Â  Â  Â  Â  pStart = start.subtract(1, 'month'); pEnd = end.subtract(1, 'month');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const currentPeriodTxns = transactions.filter(t => dayjs(t.date).isBetween(start, end, null, '[]'));

Â  Â  Â  Â  Â  Â  const prevPeriodTxns = transactions.filter(t => dayjs(t.date).isBetween(pStart, pEnd, null, '[]'));

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const calculateMetrics = (txns) => ({

Â  Â  Â  Â  Â  Â  Â  Â  income: txns.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0),

Â  Â  Â  Â  Â  Â  Â  Â  expense: txns.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0),

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  const currentMetrics = calculateMetrics(currentPeriodTxns); currentMetrics.net = currentMetrics.income - currentMetrics.expense;

Â  Â  Â  Â  Â  Â  const prevMetrics = calculateMetrics(prevPeriodTxns); prevMetrics.net = prevMetrics.income - prevMetrics.expense;

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const formatComp = (current, previous) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (previous === 0) return current > 0 ? `(â†‘)` : ``;

Â  Â  Â  Â  Â  Â  Â  Â  const percentChange = ((current - previous) / Math.abs(previous)) * 100;

Â  Â  Â  Â  Â  Â  Â  Â  return `<span style="color:${percentChange >= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">(${percentChange >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(percentChange).toFixed(1)}%)</span> vs prev. period`;

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  document.getElementById('summary-income').textContent = formatCurrency(currentMetrics.income);

Â  Â  Â  Â  Â  Â  document.getElementById('summary-income-comp').innerHTML = formatComp(currentMetrics.income, prevMetrics.income);

Â  Â  Â  Â  Â  Â  document.getElementById('summary-expense').textContent = formatCurrency(currentMetrics.expense);

Â  Â  Â  Â  Â  Â  document.getElementById('summary-expense-comp').innerHTML = formatComp(currentMetrics.expense, prevMetrics.expense);

Â  Â  Â  Â  Â  Â  document.getElementById('summary-net').textContent = formatCurrency(currentMetrics.net);

Â  Â  Â  Â  Â  Â  document.getElementById('summary-net-comp').innerHTML = formatComp(currentMetrics.net, prevMetrics.net);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  renderCategoryBreakdown(currentPeriodTxns, prevPeriodTxns);

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderCategoryBreakdown(currentTxns, prevTxns) {

Â  Â  Â  Â  Â  Â  const table = document.getElementById('category-breakdown-table');

Â  Â  Â  Â  Â  Â  const getCategoryTotals = (txns) => txns.reduce((acc, t) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[t.category]) acc[t.category] = { income: 0, expense: 0 };

Â  Â  Â  Â  Â  Â  Â  Â  acc[t.category][t.type.toLowerCase()] += t.amount;

Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  }, {});



Â  Â  Â  Â  Â  Â  const currentCategoryTotals = getCategoryTotals(currentTxns);

Â  Â  Â  Â  Â  Â  const prevCategoryTotals = getCategoryTotals(prevTxns);

Â  Â  Â  Â  Â  Â  const totalCurrentExpense = Object.values(currentCategoryTotals).reduce((sum, cat) => sum + cat.expense, 0);

Â  Â  Â  Â  Â  Â  const allCategories = [...new Set([...Object.keys(currentCategoryTotals), ...Object.keys(prevCategoryTotals)])];



Â  Â  Â  Â  Â  Â  let tableHTML = '<thead><tr><th>Category</th><th>Type</th><th>Amount</th><th>% of Total Expense</th><th>Change vs Prev.</th></tr></thead><tbody>';

Â  Â  Â  Â  Â  Â  for(const category of allCategories.sort()) {

Â  Â  Â  Â  Â  Â  Â  Â  const current = currentCategoryTotals[category] || { income: 0, expense: 0 };

Â  Â  Â  Â  Â  Â  Â  Â  const previous = prevCategoryTotals[category] || { income: 0, expense: 0 };

Â  Â  Â  Â  Â  Â  Â  Â  if (current.income > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const change = current.income - previous.income;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += `<tr><td>${category}</td><td><span class="category-badge" style="background-color:#d4edda; color:#155724;">Income</span></td><td>${formatCurrency(current.income)}</td><td>-</td><td style="color:${change >= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">${change >= 0 ? '+' : ''}${formatCurrency(change)}</td></tr>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (current.expense > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const change = current.expense - previous.expense;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percentOfTotal = totalCurrentExpense > 0 ? (current.expense / totalCurrentExpense * 100).toFixed(1) + '%' : '0%';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += `<tr><td>${category}</td><td><span class="category-badge" style="background-color:#f8d7da; color:#721c24;">Expense</span></td><td>${formatCurrency(current.expense)}</td><td>${percentOfTotal}</td><td style="color:${change <= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">${change >= 0 ? '+' : ''}${formatCurrency(change)}</td></tr>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  table.innerHTML = tableHTML + '</tbody>';

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderExpectedFunds(data) {

Â  Â  Â  Â  Â  Â  const totalExpected = data.reduce((s, t) => s + t.expectedAmount, 0);

Â  Â  Â  Â  Â  Â  const totalReceived = data.reduce((s, t) => s + t.receivedAmount, 0);

Â  Â  Â  Â  Â  Â  document.getElementById('total-expected').textContent = formatCurrency(totalExpected);

Â  Â  Â  Â  Â  Â  document.getElementById('total-received').textContent = formatCurrency(totalReceived);

Â  Â  Â  Â  Â  Â  document.getElementById('total-remaining-expected').textContent = formatCurrency(totalExpected - totalReceived);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const tbody = document.querySelector("#expected-funds-table tbody");

Â  Â  Â  Â  Â  Â  tbody.innerHTML = data.map(item => {

Â  Â  Â  Â  Â  Â  Â  Â  const remaining = item.expectedAmount - item.receivedAmount;

Â  Â  Â  Â  Â  Â  Â  Â  return `<tr>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${item.source}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(item.expectedAmount)}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(item.receivedAmount)}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(remaining)}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; gap: 8px; flex-wrap: wrap;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${remaining > 0 ? `<button class="action-btn" data-id="${item.id}" data-action="receive" title="Receive Funds" style="background-color: var(--success-color);"><i class="fas fa-hand-holding-usd"></i></button>` : '<span style="color: var(--text-secondary);">Completed</span>'}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" data-id="${item.id}" data-action="edit-expected" title="Edit Expected Fund"><i class="fas fa-edit"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" data-id="${item.id}" data-action="delete-expected" title="Delete Expected Fund" style="background-color:var(--danger-color);"><i class="fas fa-trash-alt"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>

Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;

Â  Â  Â  Â  Â  Â  }).join('') || `<tr><td colspan="5">No expected funds added.</td></tr>`;



Â  Â  Â  Â  Â  Â  // Corrected to use e.currentTarget.dataset.id

Â  Â  Â  Â  Â  Â  tbody.querySelectorAll('button[data-action="receive"]').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => openReceiveExpectedModal(e.currentTarget.dataset.id);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  tbody.querySelectorAll('button[data-action="edit-expected"]').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => openEditExpectedModal(e.currentTarget.dataset.id);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  tbody.querySelectorAll('button[data-action="delete-expected"]').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => deleteExpectedEntry(e.currentTarget.dataset.id);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderBudgets(transactions, budgets) {

Â  Â  Â  Â  Â  Â  const budgetsContainer = document.getElementById('budgets-container');

Â  Â  Â  Â  Â  Â  const definedBudgetsTbody = document.querySelector("#defined-budgets-table tbody");

Â  Â  Â  Â  Â  Â  budgetsContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  definedBudgetsTbody.innerHTML = '';



Â  Â  Â  Â  Â  Â  if (Object.keys(budgets).length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  for (const category in budgets) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  definedBudgetsTbody.innerHTML += `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${category}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(budgets[category])}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><button class="action-btn" data-category="${category}" data-action="delete-budget" style="background-color:var(--danger-color);"><i class="fas fa-trash-alt"></i></button></td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  definedBudgetsTbody.innerHTML = '<tr><td colspan="3">No budgets set.</td></tr>';

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  document.querySelectorAll('button[data-action="delete-budget"]').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => deleteBudget(e.currentTarget.dataset.category);

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  const currentMonthExpenses = transactions

Â  Â  Â  Â  Â  Â  Â  Â  .filter(t => t.type === 'Expense' && dayjs(t.date).isSame(dayjs(), 'month'))

Â  Â  Â  Â  Â  Â  Â  Â  .reduce((acc, t) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[t.category] = (acc[t.category] || 0) + t.amount;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;

Â  Â  Â  Â  Â  Â  Â  Â  }, {});



Â  Â  Â  Â  Â  Â  if (Object.keys(budgets).length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  for (const category in budgets) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const budgetAmount = parseFloat(budgets[category]);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const spentAmount = currentMonthExpenses[category] || 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percentage = budgetAmount > 0 ? (spentAmount / budgetAmount) * 100 : 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let progressBarColor = 'var(--success-color)';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (percentage > 75 && percentage <= 100) progressBarColor = 'var(--warning-color)';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (percentage > 100) progressBarColor = 'var(--danger-color)';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const budgetCard = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  budgetCard.className = 'card info';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  budgetCard.innerHTML = `<h3>${category}</h3><p>Spent ${formatCurrency(spentAmount)} of ${formatCurrency(budgetAmount)}</p><div class="progress-bar" style="margin-top: 10px;"><div class="progress-bar-fill" style="width: ${Math.min(100, percentage)}%; background-color: ${progressBarColor};">${percentage.toFixed(0)}%</div></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  budgetsContainer.appendChild(budgetCard);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  budgetsContainer.innerHTML = '<p>No budgets defined. Use the form on the left to add one.</p>';

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  function renderPassbook(data) {

Â  Â  Â  Â  Â  Â  const tableBody = document.querySelector("#passbook-table tbody");

Â  Â  Â  Â  Â  Â  tableBody.innerHTML = '';

Â  Â  Â  Â  Â  Â  let currentBalance = 0;

Â  Â  Â  Â  Â  Â  const sortedData = [...data].sort((a, b) => dayjs(a.date).diff(dayjs(b.date)));

Â  Â  Â  Â  Â  Â  const reversedData = sortedData.slice().reverse(); // Show newest first in table



Â  Â  Â  Â  Â  Â  const balanceMap = new Map();

Â  Â  Â  Â  Â  Â  sortedData.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  currentBalance += (item.type === 'Income' ? item.amount : -item.amount);

Â  Â  Â  Â  Â  Â  Â  Â  balanceMap.set(item.id, currentBalance);

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  tableBody.innerHTML = reversedData.map(item => {

Â  Â  Â  Â  Â  Â  Â  Â  const receiptCell = item.isSheetÂ 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'From Google Sheet'Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : (item.receiptUrl ? `<a href="${item.receiptUrl}" target="_blank" class="action-btn" style="background-color:var(--info-color);"><i class="fas fa-receipt"></i> View</a>` : 'N/A');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  <tr>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${item.date}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${item.description}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="category-badge" style="background-color: ${item.type === 'Income' ? '#d4edda' : '#f8d7da'}; color: ${item.type === 'Income' ? '#155724' : '#721c24'};">${item.category}</span></td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="color: ${item.type === 'Income' ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 500;">${item.type}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(item.amount)}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(balanceMap.get(item.id))}</td>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${receiptCell}</td>

Â  Â  Â  Â  Â  Â  Â  Â  </tr>`

Â  Â  Â  Â  Â  Â  }).join('') || `<tr><td colspan="7">No transactions found.</td></tr>`;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  function renderManageDataTables(transactions) {

Â  Â  Â  Â  Â  Â  const incomeTableBody = document.querySelector("#manage-income-table tbody");

Â  Â  Â  Â  Â  Â  const expenseTableBody = document.querySelector("#manage-expense-table tbody");

Â  Â  Â  Â  Â  Â  incomeTableBody.innerHTML = '';

Â  Â  Â  Â  Â  Â  expenseTableBody.innerHTML = '';

Â  Â  Â  Â  Â  Â  const incomes = transactions.filter(t => t.type === 'Income');

Â  Â  Â  Â  Â  Â  const expenses = transactions.filter(t => t.type === 'Expense');



Â  Â  Â  Â  Â  Â  incomes.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  incomeTableBody.innerHTML += `<tr><td>${item.date}</td><td>${item.description}</td><td>${formatCurrency(item.amount)}</td><td><button class="action-btn" data-id="${item.id}" data-type="Income" data-action="edit"><i class="fas fa-edit"></i> Edit</button><button class="action-btn" data-id="${item.id}" data-type="Income" data-action="delete" style="background-color:var(--danger-color);"><i class="fas fa-trash-alt"></i> Delete</button></td></tr>`;

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  expenses.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  expenseTableBody.innerHTML += `<tr><td>${item.date}</td><td>${item.description}</td><td>${formatCurrency(item.amount)}</td><td>${item.receiptUrl ? `<a href="${item.receiptUrl}" target="_blank" class="action-btn" style="background-color:var(--info-color);"><i class="fas fa-receipt"></i></a>` : ''}<button class="action-btn" data-id="${item.id}" data-type="Expense" data-action="edit"><i class="fas fa-edit"></i> Edit</button><button class="action-btn" data-id="${item.id}" data-type="Expense" data-action="delete" style="background-color:var(--danger-color);"><i class="fas fa-trash-alt"></i> Delete</button></td></tr>`;

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  document.querySelectorAll('#manage-income-table button, #manage-expense-table button').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { id, type, action } = e.currentTarget.dataset;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (action === 'edit') openEditModal(id, type);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (action === 'delete') deleteEntry(id, type);

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  function populateFilterDropdowns(transactions) {

Â  Â  Â  Â  Â  Â  const categoryFilter = document.getElementById('category-filter');

Â  Â  Â  Â  Â  Â  const uniqueCategories = [...new Set(transactions.map(t => t.category))].sort();

Â  Â  Â  Â  Â  Â  const currentVal = categoryFilter.value;

Â  Â  Â  Â  Â  Â  categoryFilter.innerHTML = '<option value="">All Categories</option>';

Â  Â  Â  Â  Â  Â  uniqueCategories.forEach(cat => categoryFilter.innerHTML += `<option value="${cat}">${cat}</option>`);

Â  Â  Â  Â  Â  Â  categoryFilter.value = currentVal;

Â  Â  Â  Â  }



Â  Â  Â  Â  function populateBudgetCategoryDropdown() {

Â  Â  Â  Â  Â  Â  const budgetCategorySelect = document.getElementById('budget-category');

Â  Â  Â  Â  Â  Â  const expenseCategorySelect = document.getElementById('expense-category');

Â  Â  Â  Â  Â  Â  const categories = [...expenseCategorySelect.options].map(opt => opt.value).filter(val => val);

Â  Â  Â  Â  Â  Â  const currentVal = budgetCategorySelect.value;

Â  Â  Â  Â  Â  Â  budgetCategorySelect.innerHTML = '<option value="" disabled selected>Select an Expense Category</option>';

Â  Â  Â  Â  Â  Â  categories.forEach(cat => budgetCategorySelect.innerHTML += `<option value="${cat}">${cat}</option>`);

Â  Â  Â  Â  Â  Â  budgetCategorySelect.value = currentVal;

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- INITIALIZATION ---

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {

Â  Â  Â  Â  Â  Â  setLoading(true, 'Loading Data...');

Â  Â  Â  Â  Â  Â  // Fetch sheet data first

Â  Â  Â  Â  Â  Â  await fetchSheetData();

Â  Â  Â  Â  Â  Â  // Then set up Firebase listeners

Â  Â  Â  Â  Â  Â  setupRealtimeListeners();

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  document.getElementById('income-date').value = todayISO();

Â  Â  Â  Â  Â  Â  document.getElementById('expense-date').value = todayISO();

Â  Â  Â  Â  });

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- FORM SUBMISSIONS ---

Â  Â  Â  Â  async function submitTransaction(formType, payload) {

Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  let receiptUrl = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (payload.receiptFile) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const storageRef = storage.ref(`receipts/${Date.now()}_${payload.receiptFile.name}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await storageRef.put(payload.receiptFile);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receiptUrl = await snapshot.ref.getDownloadURL();

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("transactions").add({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: firebase.firestore.Timestamp.fromDate(new Date(payload.date)),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: payload.type,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: payload.description,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: payload.category,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: payload.amount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receiptUrl: receiptUrl,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  showToast(`${payload.type} added successfully!`, 'success');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`${formType}-form`).reset();

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`${formType}-date`).value = todayISO();

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Error adding ${payload.type}:`, error);

Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error adding entry: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  document.getElementById('income-form').addEventListener('submit', (e) => {

Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  submitTransaction('income', {

Â  Â  Â  Â  Â  Â  Â  Â  type: 'Income',

Â  Â  Â  Â  Â  Â  Â  Â  date: document.getElementById('income-date').value,

Â  Â  Â  Â  Â  Â  Â  Â  description: document.getElementById('income-desc').value,

Â  Â  Â  Â  Â  Â  Â  Â  category: document.getElementById('income-category').value,

Â  Â  Â  Â  Â  Â  Â  Â  amount: parseFloat(document.getElementById('income-amount').value)

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  });



Â  Â  Â  Â  document.getElementById('expense-form').addEventListener('submit', (e) => {

Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  submitTransaction('expense', {

Â  Â  Â  Â  Â  Â  Â  Â  type: 'Expense',

Â  Â  Â  Â  Â  Â  Â  Â  date: document.getElementById('expense-date').value,

Â  Â  Â  Â  Â  Â  Â  Â  description: document.getElementById('expense-desc').value,

Â  Â  Â  Â  Â  Â  Â  Â  category: document.getElementById('expense-category').value,

Â  Â  Â  Â  Â  Â  Â  Â  amount: parseFloat(document.getElementById('expense-amount').value),

Â  Â  Â  Â  Â  Â  Â  Â  receiptFile: document.getElementById('receipt-upload').files[0]

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  });



Â  Â  Â  Â  document.getElementById('expected-form').addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  const source = document.getElementById('expected-source').value;

Â  Â  Â  Â  Â  Â  const amount = parseFloat(document.getElementById('expected-amount').value);

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("expectedPayments").add({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: source,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  expectedAmount: amount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receivedAmount: 0,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  showToast('Expected fund added!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  e.target.reset();

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error adding expected fund: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  Â Â 

Â  Â  Â  Â  document.getElementById('add-budget-form').addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  const category = document.getElementById('budget-category').value;

Â  Â  Â  Â  Â  Â  const amount = parseFloat(document.getElementById('budget-amount').value);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  if (!category || isNaN(amount) || amount <= 0) {

Â  Â  Â  Â  Â  Â  Â  Â  showToast('Please select a category and enter a valid positive amount.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("budgets").doc(category).set({ budgetAmount: amount });

Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Budget for ${category} has been set/updated!`, 'success');

Â  Â  Â  Â  Â  Â  Â  Â  e.target.reset();

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error setting budget: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- MODAL & DATA ACTIONS ---

Â  Â  Â  Â  const modalContainer = document.getElementById('modal-container');

Â  Â  Â  Â  function openModal(title, contentHTML) {

Â  Â  Â  Â  Â  Â  modalContainer.innerHTML = `<div class="overlay show"><div class="modal-content"><h2 class="section-title">${title}</h2>${contentHTML}<button class="action-btn" style="background-color: var(--text-secondary); margin-top: 20px;" onclick="window.closeModal()">Close</button></div></div>`;

Â  Â  Â  Â  }

Â  Â  Â  Â  window.closeModal = () => { modalContainer.innerHTML = ''; };



Â  Â  Â  Â  function openEditModal(id, type) {

Â  Â  Â  Â  Â  Â  const item = state.transactions.find(t => t.id === id);

Â  Â  Â  Â  Â  Â  if (!item) return;



Â  Â  Â  Â  Â  Â  const categories = type === 'Income'Â 

Â  Â  Â  Â  Â  Â  Â  Â  ? [...document.getElementById('income-category').options].map(o=>o.value).filter(Boolean)Â 

Â  Â  Â  Â  Â  Â  Â  Â  : [...document.getElementById('expense-category').options].map(o=>o.value).filter(Boolean);



Â  Â  Â  Â  Â  Â  const contentHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <form id="edit-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="edit-date" value="${item.date}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="edit-desc" placeholder="Description" value="${item.description}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="edit-category" required>${categories.map(cat => `<option value="${cat}" ${item.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}</select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="edit-amount" placeholder="Amount" value="${item.amount}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.receiptUrl ? `<p>Current: <a href="${item.receiptUrl}" target="_blank">View Receipt</a></p>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Upload New Receipt (optional):</label><input type="file" id="edit-receipt" accept="image/*,application/pdf">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="action-btn">Save Changes</button>

Â  Â  Â  Â  Â  Â  Â  Â  </form>`;

Â  Â  Â  Â  Â  Â  openModal(`Edit ${type} Entry`, contentHTML);



Â  Â  Â  Â  Â  Â  document.getElementById('edit-form').addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newReceiptFile = document.getElementById('edit-receipt').files[0];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let receiptUrlToUpdate = item.receiptUrl;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (newReceiptFile) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const storageRef = storage.ref(`receipts/${Date.now()}_${newReceiptFile.name}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await storageRef.put(newReceiptFile);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receiptUrlToUpdate = await snapshot.ref.getDownloadURL();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("transactions").doc(id).update({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: firebase.firestore.Timestamp.fromDate(new Date(document.getElementById('edit-date').value)),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: document.getElementById('edit-desc').value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: document.getElementById('edit-category').value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: parseFloat(document.getElementById('edit-amount').value),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receiptUrl: receiptUrlToUpdate,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatedAt: firebase.firestore.FieldValue.serverTimestamp()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Entry updated!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Update failed: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  function openReceiveExpectedModal(id) {

Â  Â  Â  Â  Â  Â  console.log('Attempting to receive expected fund with ID:', id);

Â  Â  Â  Â  Â  Â  const item = state.expected.find(e => e.id === id);

Â  Â  Â  Â  Â  Â  if (!item) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Item not found for receiving:', id);

Â  Â  Â  Â  Â  Â  Â  Â  showToast('Error: Item not found for receiving.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  console.log('Found item for receiving:', item);



Â  Â  Â  Â  Â  Â  const contentHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <form id="receive-expected-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Source:</strong> ${item.source}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Remaining:</strong> ${formatCurrency(item.expectedAmount - item.receivedAmount)}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="receive-amount" placeholder="Amount to Receive" required max="${item.expectedAmount - item.receivedAmount}" value="${item.expectedAmount - item.receivedAmount}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="receive-date" value="${todayISO()}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="action-btn" style="background-color: var(--success-color);">Mark as Received</button>

Â  Â  Â  Â  Â  Â  Â  Â  </form>`;

Â  Â  Â  Â  Â  Â  openModal('Receive Expected Funds', contentHTML);



Â  Â  Â  Â  Â  Â  document.getElementById('receive-expected-form').addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const receiveAmount = parseFloat(document.getElementById('receive-amount').value);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newTotalReceived = item.receivedAmount + receiveAmount;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("expectedPayments").doc(id).update({ receivedAmount: newTotalReceived });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("transactions").add({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: firebase.firestore.Timestamp.fromDate(new Date(document.getElementById('receive-date').value)),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Income',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: `Funds received from ${item.source}`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: 'Sponsorship', // Or a more suitable category

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: receiveAmount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receiptUrl: '',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Funds received!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error receiving funds: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  // NEW: Function to open edit modal for expected funds

Â  Â  Â  Â  function openEditExpectedModal(id) {

Â  Â  Â  Â  Â  Â  console.log('Attempting to edit expected fund with ID:', id);

Â  Â  Â  Â  Â  Â  const item = state.expected.find(e => e.id === id);

Â  Â  Â  Â  Â  Â  if (!item) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Item not found for editing:', id);

Â  Â  Â  Â  Â  Â  Â  Â  showToast('Error: Item not found for editing.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  console.log('Found item for editing:', item);



Â  Â  Â  Â  Â  Â  const contentHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <form id="edit-expected-form" class="form">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="edit-expected-source">Source:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="edit-expected-source" value="${item.source}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="edit-expected-amount">Expected Amount:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="edit-expected-amount" value="${item.expectedAmount}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="edit-expected-received">Received Amount:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" step="0.01" id="edit-expected-received" value="${item.receivedAmount}" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="action-btn">Save Changes</button>

Â  Â  Â  Â  Â  Â  Â  Â  </form>`;

Â  Â  Â  Â  Â  Â  openModal('Edit Expected Fund Entry', contentHTML);



Â  Â  Â  Â  Â  Â  document.getElementById('edit-expected-form').addEventListener('submit', async (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newSource = document.getElementById('edit-expected-source').value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newExpectedAmount = parseFloat(document.getElementById('edit-expected-amount').value);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newReceivedAmount = parseFloat(document.getElementById('edit-expected-received').value);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("expectedPayments").doc(id).update({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: newSource,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  expectedAmount: newExpectedAmount,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  receivedAmount: newReceivedAmount

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Expected fund entry updated!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeModal();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Update failed: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  // NEW: Function to delete expected fund entry

Â  Â  Â  Â  async function deleteExpectedEntry(id) {

Â  Â  Â  Â  Â  Â  console.log('Attempting to delete expected fund with ID:', id);

Â  Â  Â  Â  Â  Â  const confirmed = await showConfirmModal('Are you sure you want to delete this expected fund entry? This cannot be undone.');

Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("expectedPayments").doc(id).delete();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Expected fund entry deleted!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error deleting expected fund entry: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }





Â  Â  Â  Â  async function deleteEntry(id, type) {

Â  Â  Â  Â  Â  Â  const confirmed = await showConfirmModal(`Are you sure you want to delete this ${type} entry? This cannot be undone.`);

Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const docRef = db.collection("transactions").doc(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const doc = await docRef.get();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (doc.exists && doc.data().receiptUrl) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await storage.refFromURL(doc.data().receiptUrl).delete().catch(err => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (err.code !== 'storage/object-not-found') throw err;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await docRef.delete();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Entry deleted successfully!', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error deleting entry: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  async function deleteBudget(category) {

Â  Â  Â  Â  Â  Â  const confirmed = await showConfirmModal(`Are you sure you want to delete the budget for "${category}"?`);

Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection("budgets").doc(category).delete();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Budget for "${category}" deleted.`, 'success');

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error deleting budget: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- NAVIGATION & FILTERS ---

Â  Â  Â  Â  document.querySelectorAll(".nav-btn").forEach(button=>{button.addEventListener("click",function(){if(this.id==="sync-button")return;document.querySelectorAll(".nav-btn").forEach(btn=>btn.classList.remove("active"));this.classList.add("active");document.querySelectorAll(".page").forEach(page=>page.classList.remove("active"));document.getElementById(`page-${this.dataset.page}`).classList.add("active");renderAll()})});

Â  Â  Â  Â  document.getElementById("summary-period-filter").addEventListener("change",function(){document.getElementById("summary-custom-range").style.display=this.value==="custom"?"flex":"none"});

Â  Â  Â  Â  document.getElementById("summary-apply-filter").addEventListener("click",() => updateSummaryPage([...state.transactions, ...state.batchTransactions]));

Â  Â  Â  Â  document.getElementById("filter-btn").addEventListener("click",function(){

Â  Â  Â  Â  Â  Â  const startDate=document.getElementById("start-date-filter").value;

Â  Â  Â  Â  Â  Â  const endDate=document.getElementById("end-date-filter").value;

Â  Â  Â  Â  Â  Â  const category=document.getElementById("category-filter").value;

Â  Â  Â  Â  Â  Â  const type=document.getElementById("type-filter").value;

Â  Â  Â  Â  Â  Â  let filtered=[...state.transactions, ...state.batchTransactions];

Â  Â  Â  Â  Â  Â  if(startDate)filtered=filtered.filter(t=>dayjs(t.date).isSameOrAfter(dayjs(startDate)));

Â  Â  Â  Â  Â  Â  if(endDate)filtered=filtered.filter(t=>dayjs(t.date).isSameOrBefore(dayjs(endDate)));

Â  Â  Â  Â  Â  Â  if(category)filtered=filtered.filter(t=>t.category===category);

Â  Â  Â  Â  Â  Â  if(type)filtered=filtered.filter(t=>t.type===type);

Â  Â  Â  Â  Â  Â  renderPassbook(filtered)

Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById("clear-filter-btn").addEventListener("click",()=>{

Â  Â  Â  Â  Â  Â  document.getElementById("start-date-filter").value="";

Â  Â  Â  Â  Â  Â  document.getElementById("end-date-filter").value="";

Â  Â  Â  Â  Â  Â  document.getElementById("category-filter").value="";

Â  Â  Â  Â  Â  Â  document.getElementById("type-filter").value="";

Â  Â  Â  Â  Â  Â  renderPassbook([...state.transactions, ...state.batchTransactions])

Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById("export-csv-btn").addEventListener("click",()=>{const table=document.getElementById("passbook-table");let csv=[[...table.querySelectorAll("thead th")].map(th=>`"${th.innerText}"`).join(",")];table.querySelectorAll("tbody tr").forEach(tr=>{let row=[...tr.querySelectorAll("td")].map(td=>`"${td.innerText.replace(/"/g,'""')}"`);csv.push(row.join(","))});const a=document.createElement("a");a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv.join("\n"));a.download="passbook_export.csv";a.click();showToast("Passbook exported!")});

Â  Â  Â  Â  ["income","expense"].forEach(type=>{document.getElementById(`search-${type}`).addEventListener("input",function(){const searchTerm=this.value.toLowerCase();document.querySelectorAll(`#manage-${type}-table tbody tr`).forEach(row=>{row.style.display=row.cells[1].textContent.toLowerCase().includes(searchTerm)?"":"none"})})});

Â  Â  Â  Â  document.getElementById("sync-button").addEventListener("click",async()=>{

Â  Â  Â  Â  Â  Â  const confirmed = await showConfirmModal("Run automated sync? This calls a Firebase Cloud Function to import data.");

Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  setLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  try{

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const syncSheetData=functions.httpsCallable("syncAutomatedEntries");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result=await syncSheetData();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Sync complete: ${result.data.message}`,"success");

Â  Â  Â  Â  Â  Â  Â  Â  }catch(error){

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error calling sync function:",error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Sync failed: ${error.message}`,"error");

Â  Â  Â  Â  Â  Â  Â  Â  }finally{

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  </script>

</body>

</html>
